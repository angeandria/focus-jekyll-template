{% assign target_topic = include.topic %}
{% assign type_string = include.type | default: "page" %}
{% assign type_array = type_string | split: ", " %}

{% assign topic_sort = include.sort | "priority" %}
{% assign topic_order = include.order | "reverse" %}
{% assign topic_limit = include.limit | 1 %}


<h3>{{ target_topic }}:</h3>

<ul>
  <li>priority : {{ topic_priority}}</li>
<li>limit : {{ topic_limit}}</li>
<li>order : {{ topic_order}}</li>
</ul>

{% for type in type_array %}
    {% if type == "page" %}
        {% assign categorized_pages = site.pages | where: "categories", target_topic | sort: topic_sort | limit: topic_limit %}
        
        {% if topic_order == "reverse" %}
            {% assign categorized_pages = categorized_pages | reverse %}
        {% endif %}
        
        {% if categorized_pages.size > 0 %}
            <h4>Pages "{{ target_topic }}"</h4>
            <ul>
                {% for page in categorized_pages %}
                    <li><a href="{{ page.url }}">{{ page.title }}</a></li>
                {% endfor %}        
            </ul>    
        {% endif %}

    {% elsif type == "post" %}
        {% if site.categories[target_topic] %}
            <h4>Posts "{{ target_topic }}"</h4>
            {% assign sorted_posts = site.categories[target_topic] | sort: topic_sort | limit: topic_limit | topic_order %}
            
            {% if topic_order == "reverse" %}
            {% assign sorted_posts = sorted_posts | reverse %}
        {% endif %}
            <ul>
            {% for post in sorted_posts %}
                {% if post.url %}
                    <li><a href="{{ post.url }}">{{ post.title }}</a> (Priority: {{ post.priority }})</li>
                {% endif %}
            {% endfor %}    
            </ul>
        {% endif %}

    {% endif %}
{% endfor %}